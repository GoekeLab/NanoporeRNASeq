---
title: "An introduction to the bambu package using NanoporeRNASeq data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{NanoporeRNASeq}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---



```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE, tidy = TRUE,
  warning=FALSE, message=FALSE,
  comment = "##>"
)
```

## Introduction
*[NanoporeRNASeq](https://github.com/GoekeLab/NanoporeRNASeq)* contains single chromosome RNA-Seq data from two common cell lines K562 and MCF7. Each of these cell line has three replicates, with 1 direct RNA sequencing data and 2 cDNA sequencing data. 

## Accessing NanoporeRNASeq data
### Load the NanoporeRNASeq package
```{r setup}
devtools::load_all()
library("NanoporeRNASeq")
```

### Get the bam file names
```{r}
data("bamFiles")
bamFiles <- Rsamtools::BamFileList(system.file("extdata", bamFiles, package = "NanoporeRNASeq"))
bamFiles
```

### Get the annotation GRangesList
```{r}
data("annotation")
annotation
```

## Visualizing gene of interest from a single bam file
visualizing a single gene ENST00000215832 (MAPK1)
```{r, fig.width = 12}
library(ggbio)
range <- annotation$ENST00000215832
# plot annotation track
tx <- autoplot(range, aes(type = model, col=strand), group.selfish = TRUE)
# plot coverage track
coverage <- autoplot(bamFiles[[1]], aes(col=coverage),which = range)
# plot mismatch track
library(BSgenome.Hsapiens.NCBI.GRCh38)
mismatch <- autoplot(bamFiles[[1]], stat="mismatch", which=range, bsgenome=Hsapiens)
#merge the tracks into one plot
tracks(annotation = tx, mismatch = mismatch, coverage = coverage,
       heights = c(1, 3, 3))+ theme_minimal()
```

## Running Bambu with NanoporeRNASeq data
### Load the bambu package
```{r}
library(bambu)
library(BSgenome.Hsapiens.NCBI.GRCh38)
#packages for plotting
library(circlize)
library(ComplexHeatmap)
library(ggbio)
```

### Run bambu
```{r, results = "hide"}
se <- bambu(reads = bamFiles, annotations = annotation, genomeSequence = "BSgenome.Hsapiens.NCBI.GRCh38")
se
```

### Check for single gene examples
Single gene examples can also be checked using plot functions from *bambu*
```{r, fig.width = 8, fig.height = 10}
plot.bambu(se, type = "annotation", gene_id = unique(rowData(se)$GENEID)[10])
```
